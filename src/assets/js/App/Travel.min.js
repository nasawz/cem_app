/*!
 * remark (http://getbootstrapadmin.com/remark)
 * Copyright 2016 amazingsurge
 * Licensed under the Themeforest Standard Licenses
 */
!function(e,t){if("function"==typeof define&&define.amd)define("/App/Travel",["exports","Site"],t);else if("undefined"!=typeof exports)t(exports,require("Site"));else{var i={exports:{}};t(i.exports,e.Site),e.AppTravel=i.exports}}(this,function(e,t){"use strict";function i(){return l||(l=new r),l}function s(){var e=i();e.run()}Object.defineProperty(e,"__esModule",{value:!0}),e.getInstance=e.run=e.AppTravel=void 0;var a=babelHelpers.interopRequireDefault(t),n=function(){function e(){babelHelpers.classCallCheck(this,e),this.window=$(window),this.$siteNavbar=$(".site-navbar"),this.$siteFooter=$(".site-footer"),this.$pageMain=$(".page-main"),this.handleMapHeight()}return babelHelpers.createClass(e,[{key:"handleMapHeight",value:function(){var e=this.$siteFooter.outerHeight(),t=this.$siteNavbar.outerHeight(),i=this.window.height()-t-e;this.$pageMain.outerHeight(i)}},{key:"getMap",value:function(){var e=L.latLng(37.769,-122.446);return L.mapbox.accessToken="pk.eyJ1IjoiYW1hemluZ3N1cmdlIiwiYSI6ImNpaDVubzBoOTAxZG11dGx4OW5hODl2b3YifQ.qudwERFDdMJhFA-B2uO6Rg",L.mapbox.map("map","mapbox.light").setView(e,18)}}]),e}(),o=function(){function e(t,i,s,a){babelHelpers.classCallCheck(this,e),this.spots=t,this.hotels=i,this.reviews=s,this.map=a,this.markers=null,this.allMarkers=[],this.addMarkersByOption("spots")}return babelHelpers.createClass(e,[{key:"deleteMarkers",value:function(){this.map.removeLayer(this.markers),this.markers=null,this.allMarkers.length=0}},{key:"addMarkersByOption",value:function(e){this.markers=new L.MarkerClusterGroup({removeOutsideVisibleBounds:!1,polygonOptions:{color:"#444"}}),this.initMarkers(this.markers,this[""+e]),this.map.addLayer(this.markers)}},{key:"initMarkers",value:function(e,t){for(var i=0;i<t.length;i++){var s=void 0,a=void 0;a=i%2===0?Number(Math.random()):-1*Math.random();var n=L.latLng(37.769+Math.random()/170*a,-122.446+Math.random()/150*a);s=$(t[i]).find("img").attr("src");var o="<div class='in-map-markers'>\n                          <div class='marker-icon'>\n                            <img src='"+s+"'/>\n                          </div>\n                        </div>",r=L.divIcon({html:o,iconAnchor:[0,0],className:""}),l=$(t[i]).find(".item-name").html(),h=$(t[i]).find(".item-title").html(),p="<div class='marker-popup-info'>\n                        <div class='detail'>info</div>\n                        <h3>"+l+"</h3>\n                        <p>"+h+"</p>\n                      </div>\n                      <i class='icon wb-chevron-right-mini'>\n                      </i>",u=L.marker(n,{title:l,icon:r}).bindPopup(p,{closeButton:!1});e.addLayer(u),this.allMarkers.push(u),u.on("popupopen",function(){this._icon.className+=" marker-active",this.setZIndexOffset(999)}),u.on("popupclose",function(){this._icon&&(this._icon.className="leaflet-marker-icon leaflet-zoom-animated leaflet-clickable"),this.setZIndexOffset(450)})}}},{key:"getAllMarkers",value:function(){return this.allMarkers}},{key:"getMarkersInMap",value:function(){for(var e=[],t=this.getAllMarkers(),i=0;i<t.length;i++)this.map.getBounds().contains(t[i].getLatLng())&&e.push(t.indexOf(t[i]));return e}}]),e}(),r=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"processed",value:function(){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"processed",this).call(this),this.window=$(window),this.$pageAside=$(".page-aside"),this.$allSpots=$(".app-travel .spot-info"),this.allSpots=this.getAllListItems(this.$allSpots),this.$allHotels=$(".app-travel .hotel-info"),this.allHotels=this.getAllListItems(this.$allHotels),this.$allReviews=$(".app-travel .review-info"),this.allReviews=this.getAllListItems(this.$allReviews),this.mapbox=new n,this.map=this.mapbox.getMap(),this.markers=new o(this.$allSpots,this.$allHotels,this.$allReviews,this.map),this.allMarkers=this.markers.getAllMarkers(),this.markersInMap=null,this.spotsNum=null,this.hotelsNum=null,this.reviewsNum=null,this.handleResize(),this.steupListItem("spots"),this.steupListItem("hotels"),this.steupListItem("reviews"),this.steupMapChange(),this.setupTabChange(),this.handleSwitchClick(),this.handleSpotAction()}},{key:"getAllListItems",value:function(e){var t=[];return e.each(function(){t.push(this)}),t}},{key:"getDefaultState",value:function(){return Object.assign(babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getDefaultState",this).call(this),{mapChange:!0,listItemActive:!1,optionChange:"spots"})}},{key:"getDefaultActions",value:function(){var e=this;return Object.assign(babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getDefaultActions",this).call(this),{optionChange:function(t){if(t){console.log("tab change"),e.markers.markers&&e.markers.deleteMarkers();var i=e.getState("optionChange");e.markers.addMarkersByOption(i),e.changeListItemsByOption(i)}},mapChange:function(t){if(t)console.log("map change");else{var i=e.getState("optionChange");e.changeListItemsByOption(i)}},listItemActive:function(t){if(t){var i=e.getState("optionChange");this.changeMapOnListActiveByOption(i)}else console.log("listItem unactive")}})}},{key:"changeListItems",value:function(e){var t=[];this.markersInMap=this.markers.getMarkersInMap();for(var i=0;i<this.allMarkers.length;i++)this.markersInMap.indexOf(i)===-1?$(e[i]).hide():($(e[i]).show(),t.push($(e[i])));return t}},{key:"onSpotsListChange",value:function(e){$(".clearfix.hidden-xl-down").remove();for(var t=0;t<e.length;t++)if(t>0&&(t+1)%2===0){var i=$("<div></div>").addClass("clearfix hidden-xl-down");e[t].after(i)}}},{key:"onReviewsListChange",value:function(e){var t=$(".last-review");t.length>0&&t.removeClass("last-review");var i=e.length;i>0&&e[i-1].addClass("last-review")}},{key:"changeListItemsByOption",value:function(e){var t=e.substring(0,1).toUpperCase()+e.substring(1),i=this.changeListItems(this["all"+t]);this["on"+t+"ListChange"]?this["on"+t+"ListChange"](i):"",this.window.trigger("resize")}},{key:"changeMapOnListActive",value:function(e){this.map.panTo(this.allMarkers[e].getLatLng()),this.allMarkers[e].openPopup()}},{key:"changeMapOnListActiveByOption",value:function(e){this.changeMapOnListActive(this[e+"Num"])}},{key:"steupListItem",value:function(e){var t=this,i=this,s=e.substring(0,1).toUpperCase()+e.substring(1);this["$all"+s].on("click",function(){$(".rating").on("click",function(e){e.stopPropagation()}),i[e+"Num"]=i["all"+s].indexOf(this),i.setState("listItemActive",!0)}),this["$all"+s].on("mouseup",function(){t.setState("listItemActive",!1)})}},{key:"setupTabChange",value:function(){var e=this,t=this;$('a[data-toggle="tab"]').on("shown.bs.tab",function(i){i.target;var s=$(e).attr("href"),a=s.substring(1);t.setState("optionChange",""+a),i.relatedTarget})}},{key:"steupMapChange",value:function(){var e=this;this.map.on("viewreset move",function(){e.setState("mapChange",!0)}),this.map.on("ready blur moveend dragend zoomend",function(){e.setState("mapChange",!1)})}},{key:"handleSwitchClick",value:function(){var e=this;$(document).on("click",".page-aside .page-aside-switch",function(t){if(e.$pageAside.hasClass("open")){var i=e.getState("optionChange");e.changeListItemsByOption(i)}else t.stopPropagation()})}},{key:"handleResize",value:function(){var e=this;this.window.on("resize",function(){e.mapbox.handleMapHeight()})}},{key:"handleSpotAction",value:function(){$(document).on("click",".card-actions",function(){var e=$(this);e.toggleClass("active")})}}]),t}(a.default),l=null;e.default=r,e.AppTravel=r,e.run=s,e.getInstance=i});