/*!
 * remark (http://getbootstrapadmin.com/remark)
 * Copyright 2016 amazingsurge
 * Licensed under the Themeforest Standard Licenses
 */
!function(e,t){if("function"==typeof define&&define.amd)define("/App/Location",["exports","Site"],t);else if("undefined"!=typeof exports)t(exports,require("Site"));else{var i={exports:{}};t(i.exports,e.Site),e.AppLocation=i.exports}}(this,function(e,t){"use strict";function i(){return l||(l=new o),l}function n(){var e=i();e.run()}Object.defineProperty(e,"__esModule",{value:!0}),e.getInstance=e.run=e.AppLocation=void 0;var s=babelHelpers.interopRequireDefault(t),a=function(){function e(){babelHelpers.classCallCheck(this,e),this.window=$(window),this.$siteNavbar=$(".site-navbar"),this.$siteFooter=$(".site-footer"),this.$pageMain=$(".page-main"),this.handleMapHeight()}return babelHelpers.createClass(e,[{key:"handleMapHeight",value:function(){var e=this.$siteFooter.outerHeight(),t=this.$siteNavbar.outerHeight(),i=this.window.height()-t-e;this.$pageMain.outerHeight(i)}},{key:"getMap",value:function(){var e=L.latLng(37.769,-122.446);return L.mapbox.accessToken="pk.eyJ1IjoiYW1hemluZ3N1cmdlIiwiYSI6ImNpaDVubzBoOTAxZG11dGx4OW5hODl2b3YifQ.qudwERFDdMJhFA-B2uO6Rg",L.mapbox.map("map","mapbox.light").setView(e,18)}}]),e}(),r=function(){function e(t,i){babelHelpers.classCallCheck(this,e),this.friends=t,this.map=i,this.allMarkers=[],this.handleMarkers()}return babelHelpers.createClass(e,[{key:"handleMarkers",value:function(){for(var e=new L.MarkerClusterGroup({removeOutsideVisibleBounds:!1,polygonOptions:{color:"#444"}}),t=0;t<this.friends.length;t++){var i=void 0,n=void 0;n=t%2===0?Number(Math.random()):-1*Math.random();var s=L.latLng(37.769+Math.random()/170*n,-122.446+Math.random()/150*n);i=$(this.friends[t]).find("img").attr("src");var a="<div class='in-map-markers'><div class='friend-icon'><img src='"+i+"' /></div></div>",r=L.divIcon({html:a,iconAnchor:[0,0],className:""}),o="<div class='friend-popup-info'><div class='detail'>info</div><h3>"+$(this.friends[t]).find(".friend-name").html()+"</h3><p>"+$(this.friends[t]).find(".friend-title").html()+"</p></div><i class='icon wb-chevron-right-mini'></i>",l=L.marker(s,{title:$(this.friends[t]).find("friend-name").html(),icon:r}).bindPopup(o,{closeButton:!1});e.addLayer(l),this.allMarkers.push(l),l.on("popupopen",function(){this._icon.className+=" marker-active",this.setZIndexOffset(999)}),l.on("popupclose",function(){this._icon&&(this._icon.className="leaflet-marker-icon leaflet-zoom-animated leaflet-clickable"),this.setZIndexOffset(450)})}this.map.addLayer(e)}},{key:"getAllMarkers",value:function(){return this.allMarkers}},{key:"getMarkersInMap",value:function(){for(var e=[],t=this.getAllMarkers(),i=0;i<t.length;i++)this.map.getBounds().contains(t[i].getLatLng())&&e.push(t.indexOf(t[i]));return e}}]),e}(),o=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"processed",value:function(){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"processed",this).call(this),this.window=$(window),this.$listItem=$(".app-location .page-aside .list-group"),this.$allFriends=$(".app-location .friend-info"),this.allFriends=this.getAllFriends(),this.mapbox=new a,this.map=this.mapbox.getMap(),this.markers=new r(this.$allFriends,this.map),this.allMarkers=this.markers.getAllMarkers(),this.markersInMap=null,this.friendNum=null,this.handleResize(),this.steupListItem(),this.steupMapChange(),this.handleSearch()}},{key:"getDefaultState",value:function(){return Object.assign(babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getDefaultState",this).call(this),{mapChange:!0,listItemActive:!1})}},{key:"getDefaultActions",value:function(){return Object.assign(babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getDefaultActions",this).call(this),{mapChange:function(e){if(e)console.log("map change");else{var t=[];this.markersInMap=this.markers.getMarkersInMap();for(var i=0;i<this.allMarkers.length;i++)this.markersInMap.indexOf(i)===-1?$(this.allFriends[i]).hide():($(this.allFriends[i]).show(),t.push($(this.allFriends[i])));this.friendsInList=t}},listItemActive:function(e){e?(this.map.panTo(this.allMarkers[this.friendNum].getLatLng()),this.allMarkers[this.friendNum].openPopup()):console.log("listItem unactive")}})}},{key:"getAllFriends",value:function(){var e=[];return this.$allFriends.each(function(){e.push(this)}),e}},{key:"steupListItem",value:function(){var e=this,t=this;this.$allFriends.on("click",function(){$(".list-inline").on("click",function(e){e.stopPropagation()}),t.friendNum=t.allFriends.indexOf(this),t.setState("listItemActive",!0)}),this.$allFriends.on("mouseup",function(){e.setState("listItemActive",!1)})}},{key:"steupMapChange",value:function(){var e=this;this.map.on("viewreset move",function(){e.setState("mapChange",!0)}),this.map.on("ready blur moveend dragend zoomend",function(){e.setState("mapChange",!1)})}},{key:"handleResize",value:function(){var e=this;this.window.on("resize",function(){e.mapbox.handleMapHeight()})}},{key:"handleSearch",value:function(){var e=this;$(".search-friends input").on("focus",function(){$(this).on("keyup",function(){for(var t=$(".search-friends input").val(),i=0;i<e.friendsInList.length;i++){var n=e.friendsInList[i].find(".friend-name").html();if(t.length<=n.length)for(var s=1;s<=t.length;s++)t.substring(0,s).toLowerCase()===n.substring(0,s).toLowerCase()?e.friendsInList[i].show():e.friendsInList[i].hide();else e.friendsInList[i].hide()}if(""===t)for(var a=0;a<e.friendsInList.length;a++)e.friendsInList[a].show()})}),$(".search-friends input").on("focusout",function(){$(this).off("keyup")})}}]),t}(s.default),l=null;e.default=o,e.AppLocation=o,e.run=n,e.getInstance=i});